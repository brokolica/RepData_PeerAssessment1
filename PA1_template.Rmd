---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

Before starting we have to load some libraries neccessary for next work. Also, we set a name of directory, in which our dataset is.
```{r settingThingsUp, echo=TRUE, results='hide'}
library(dplyr)
library(lattice)
filename <- "activity.zip"
```


## Loading and preprocessing the data
```{r loadAndPreprocess, echo=TRUE}

data <- read.csv(unz(filename, "activity.csv"),
                 header=TRUE,
                 colClasses=c("numeric","Date","numeric"))

data <- tbl_df(data)

with.NAs <- data
without.NAs <- filter(data,
                      !is.na(steps))
```


## What is mean total number of steps taken per day?
```{r meanMedianAndHistogram, echo=TRUE}

# we must group data by date
data.1 <- group_by(without.NAs,
                   date)

# the next step is adding new variable, which contains sum of steps by days
data.1 <- mutate(data.1,
                 steps.by.days=sum(steps))

# we want unique days, because each day with one date has the same sum of steps  
data.1 <- distinct(data.1,
                   date)

# finally, we can draw a histogram
hist(data.1$steps.by.days,
     xlab="Num. of steps",
     main="Histogram of number of steps taken by days",
     labels=TRUE,
     col="orange")

data1.mean <- mean(data.1$steps.by.days)
data1.median <- median(data.1$steps.by.days)
```
Mean total number of steps taken per day is `r data1.mean`, while the median has value of `r data1.median`.


## What is the average daily activity pattern?
```{r averageDailyPattern, echo=TRUE}

# we must group data by intervals
data.2 <- group_by(without.NAs,
                   interval)

# the next step is adding new variable, which contains average of steps by intervals
data.2 <- mutate(data.2,
                 average.steps.by.intervals=sum(steps)/n())

# we want unique inervals, because each interval with the same number has the same average of steps  
data.2 <- distinct(data.2,
                   interval)

# finally, we can draw a plot
with(data.2, plot(interval,
                  average.steps.by.intervals,
                  type="l"))

# we must ungroup the data so that we can find interval with maximal average steps taken
data.2 <- ungroup(data.2)

# now we can find needed interval
filter(data.2,
       average.steps.by.intervals==max(average.steps.by.intervals))$interval
```
Average daily number of steps taken 


## Imputing missing values
```{r imputingMissingValues, echo=TRUE}

sum(is.na(with.NAs))

# data <- group_by(data, interval)
# data <- mutate(data, interval.mean=mean(steps, na.rm=TRUE))
# backup <- mutate(backup, new.steps=ifelse(is.na(steps), interval.mean, steps))
```

## Are there differences in activity patterns between weekdays and weekends?
V tejto casti treba pouzit data, kde su NA hodnoty nahradene uz!!!
```{r}

# we simply add a variable containing type of the current day
data.4 <- mutate(without.NAs,
                 day.type=ifelse(weekdays(date) %in% c('sobota','nedela'),'weekend','weekday'))

# we must group data by intervals and by date.type simultaneously
data.4 <- group_by(data.4,
                   interval,
                   day.type)

data.4 <- mutate(data.4,
                 average.steps.by.day.type=sum(steps)/n())


data.4 <- distinct(data.4,
                   interval,
                   day.type)


xyplot(average.steps.by.day.type ~ interval | day.type,
       data=data.4,
       layout=c(1,2),
       type="l")

data.4 <- ungroup(data.4)

filter(data.4,
       average.steps.by.day.type==max(average.steps.by.day.type))
```